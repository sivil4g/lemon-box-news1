<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Регистрация | Lemon Box News</title>
    
    <!-- Шрифты -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Nunito:wght@400;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- CSS -->
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/components/header.css">
    <link rel="stylesheet" href="styles/components/footer.css">
    <link rel="stylesheet" href="styles/pages/auth.css">
    
    <link rel="icon" type="image/x-icon" href="https://img.icons8.com/color/96/000000/lemon.png">
</head>
<body>
    <!-- Шапка -->
    <header class="header">
        <div class="container">
            <a href="index.html" class="logo">
                <div class="logo-icon">
                    <i class="fas fa-lemon"></i>
                </div>
                <div class="logo-text">
                    <div class="logo-title">Lemon <span>Box</span> News</div>
                    <div class="logo-subtitle">Официальный новостной портал</div>
                </div>
            </a>

            <!-- Быстрая навигация по страницам -->
            <div class="quick-nav">
                <a href="index.html" class="quick-nav-link">
                    <i class="fas fa-home"></i> Главная
                </a>
                <a href="login.html" class="quick-nav-link">
                    <i class="fas fa-sign-in-alt"></i> Войти
                </a>
                <a href="register.html" class="quick-nav-link active">
                    <i class="fas fa-user-plus"></i> Регистрация
                </a>
                <a href="forum.html" class="quick-nav-link">
                    <i class="fas fa-comments"></i> Форум
                </a>
            </div>

            <nav class="nav">
                <a href="index.html" class="nav-link">
                    <i class="fas fa-home"></i> Главная
                </a>
                <a href="login.html" class="nav-link">
                    <i class="fas fa-sign-in-alt"></i> Вход
                </a>
                <a href="register.html" class="nav-link active">
                    <i class="fas fa-user-plus"></i> Регистрация
                </a>
                <a href="forum.html" class="nav-link">
                    <i class="fas fa-comments"></i> Форум
                </a>
            </nav>

            <!-- Меню пользователя (скрыто по умолчанию) -->
            <div class="user-menu" id="userMenu" style="display: none;">
                <div class="user-dropdown">
                    <button class="user-btn">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <span class="user-name" id="userName">Пользователь</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-menu">
                        <a href="profile.html" class="dropdown-item">
                            <i class="fas fa-user"></i> Мой профиль
                        </a>
                        <a href="my-posts.html" class="dropdown-item">
                            <i class="fas fa-comment"></i> Мои сообщения
                        </a>
                        <a href="settings.html" class="dropdown-item">
                            <i class="fas fa-cog"></i> Настройки
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Выйти
                        </a>
                    </div>
                </div>
            </div>

            <button class="menu-toggle" id="menuToggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <!-- Основной контент -->
    <main class="auth-page">
        <div class="container container-xs">
            <div class="auth-container">
                <div class="auth-box">
                    <div class="auth-header">
                        <h2><i class="fas fa-user-plus"></i> Создание аккаунта</h2>
                        <p>Зарегистрируйтесь, чтобы получить доступ ко всем возможностям форума</p>
                    </div>
                    
                    <div id="message" class="message"></div>
                    
                    <!-- Прогресс регистрации -->
                    <div class="registration-progress">
                        <div class="progress-step active">
                            <div class="step-number">1</div>
                            <div class="step-label">Данные</div>
                        </div>
                        <div class="progress-step">
                            <div class="step-number">2</div>
                            <div class="step-label">Подтверждение</div>
                        </div>
                        <div class="progress-step">
                            <div class="step-number">3</div>
                            <div class="step-label">Готово</div>
                        </div>
                    </div>
                    
                    <form id="registerForm" class="auth-form">
                        <div class="form-group">
                            <label for="username" class="form-label">
                                <i class="fas fa-user"></i> Игровой никнейм
                            </label>
                            <input type="text" 
                                   id="username" 
                                   class="form-control"
                                   placeholder="Введите ваш ник в игре"
                                   required
                                   minlength="3"
                                   maxlength="20"
                                   pattern="[A-Za-z0-9_]+"
                                   autocomplete="username">
                            <div class="form-help">Только буквы, цифры и подчеркивание. Без пробелов.</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="email" class="form-label">
                                <i class="fas fa-envelope"></i> Email
                            </label>
                            <input type="email" 
                                   id="email" 
                                   class="form-control"
                                   placeholder="example@gmail.com"
                                   required
                                   autocomplete="email">
                            <div class="form-help">На этот email придет подтверждение</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="password" class="form-label">
                                <i class="fas fa-lock"></i> Пароль
                            </label>
                            <input type="password" 
                                   id="password" 
                                   class="form-control"
                                   placeholder="Минимум 6 символов"
                                   required
                                   minlength="6"
                                   autocomplete="new-password">
                            <div class="password-strength">
                                <div class="strength-bar" id="strengthBar"></div>
                                <span class="strength-text" id="strengthText">Сложность: слабый</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="confirmPassword" class="form-label">
                                <i class="fas fa-lock"></i> Подтверждение пароля
                            </label>
                            <input type="password" 
                                   id="confirmPassword" 
                                   class="form-control"
                                   placeholder="Повторите пароль"
                                   required
                                   autocomplete="new-password">
                            <span class="password-match" id="passwordMatch"></span>
                        </div>
                        
                        <div class="form-check">
                            <input type="checkbox" id="terms" required>
                            <label for="terms">
                                Я согласен с <a href="#" class="terms-link">правилами форума</a> и 
                                <a href="#" class="terms-link">политикой конфиденциальности</a>
                            </label>
                        </div>
                        
                        <div class="form-check">
                            <input type="checkbox" id="newsletter" checked>
                            <label for="newsletter">
                                Хочу получать новости об обновлениях и событиях игры
                            </label>
                        </div>
                        
                        <button type="submit" class="btn btn-auth" id="submitBtn">
                            <i class="fas fa-user-plus"></i> Создать аккаунт
                        </button>
                    </form>
                    
                    <div class="auth-divider">
                        <span>или зарегистрироваться через</span>
                    </div>
                    
                    <div class="social-auth">
                        <a href="#" class="social-btn google-btn">
                            <i class="fab fa-google"></i> Google
                        </a>
                        <a href="#" class="social-btn discord-btn">
                            <i class="fab fa-discord"></i> Discord
                        </a>
                    </div>
                    
                    <div class="auth-links">
                        Уже есть аккаунт? <a href="login.html">Войти</a>
                    </div>
                    
                    <div class="auth-info">
                        <h4><i class="fas fa-star"></i> Преимущества регистрации</h4>
                        <ul>
                            <li>Доступ ко всем разделам форума</li>
                            <li>Создание собственных тем и сообщений</li>
                            <li>Участие в голосованиях и опросах</li>
                            <li>Персональная статистика игрока</li>
                            <li>Специальные награды и достижения</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Подвал -->
    <footer class="footer">
        <div class="container">
            <div class="footer-logo">
                <div class="footer-logo-icon">
                    <i class="fas fa-lemon"></i>
                </div>
                <h3 class="footer-logo-title">Lemon <span>Box</span> News</h3>
                <p class="footer-logo-text">Официальный источник новостей игры Lemon Box © 2024</p>
            </div>
            
            <div class="footer-links">
                <h4 class="footer-heading">Навигация</h4>
                <a href="index.html" class="footer-link">
                    <i class="fas fa-home"></i> Главная
                </a>
                <a href="login.html" class="footer-link">
                    <i class="fas fa-sign-in-alt"></i> Вход
                </a>
                <a href="register.html" class="footer-link">
                    <i class="fas fa-user-plus"></i> Регистрация
                </a>
                <a href="forum.html" class="footer-link">
                    <i class="fas fa-comments"></i> Форум
                </a>
            </div>
            
            <div class="footer-social">
                <h4 class="footer-heading">Официальные каналы</h4>
                <div class="social-icons">
                    <a href="#" class="social-link">
                        <i class="fab fa-youtube"></i>
                    </a>
                    <a href="#" class="social-link">
                        <i class="fab fa-discord"></i>
                    </a>
                    <a href="#" class="social-link">
                        <i class="fab fa-telegram"></i>
                    </a>
                    <a href="#" class="social-link">
                        <i class="fab fa-vk"></i>
                    </a>
                </div>
                <div class="footer-contact">
                    <div class="contact-item">
                        <i class="fas fa-envelope"></i>
                        <a href="mailto:support@lemonbox.game" class="contact-link">
                            support@lemonbox.game
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p class="footer-text">Lemon Box — динамичная онлайн игра с регулярными обновлениями и системой достижений.</p>
            <p class="footer-copyright">
                © 2024 Lemon Box News. Все права защищены.
                <span class="age-rating">12+</span>
            </p>
        </div>
    </footer>

    <!-- Кнопка "Наверх" -->
    <button class="back-to-top" id="backToTop">
        <i class="fas fa-chevron-up"></i>
    </button>

    <!-- JS -->
    <script src="js/supabase-config.js"></script>
    <script src="js/auth-functions.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/script.js"></script>
    
    <script>
        // Активация меню пользователя
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = localStorage.getItem('currentUser');
            const userMenu = document.getElementById('userMenu');
            
            if (currentUser) {
                try {
                    const user = JSON.parse(currentUser);
                    document.getElementById('userName').textContent = user.username;
                    userMenu.style.display = 'flex';
                    
                    // Если пользователь уже авторизован, редиректим на главную
                    window.location.href = 'index.html';
                } catch (e) {
                    localStorage.removeItem('currentUser');
                }
            }
            
            // Проверка сложности пароля
            const passwordInput = document.getElementById('password');
            const strengthBar = document.getElementById('strengthBar');
            const strengthText = document.getElementById('strengthText');
            
            if (passwordInput) {
                passwordInput.addEventListener('input', function() {
                    const password = this.value;
                    let strength = 0;
                    
                    // Критерии сложности
                    if (password.length >= 6) strength += 20;
                    if (password.length >= 8) strength += 20;
                    if (/[A-Z]/.test(password)) strength += 20;
                    if (/[0-9]/.test(password)) strength += 20;
                    if (/[^A-Za-z0-9]/.test(password)) strength += 20;
                    
                    // Обновляем индикатор
                    strengthBar.style.width = strength + '%';
                    
                    if (strength < 40) {
                        strengthBar.style.background = '#ff6b6b';
                        strengthText.textContent = 'Сложность: слабый';
                    } else if (strength < 70) {
                        strengthBar.style.background = '#ffa94d';
                        strengthText.textContent = 'Сложность: средний';
                    } else {
                        strengthBar.style.background = '#4CAF50';
                        strengthText.textContent = 'Сложность: надежный';
                    }
                });
            }
            
            // Проверка совпадения паролей
            const confirmPasswordInput = document.getElementById('confirmPassword');
            const passwordMatchSpan = document.getElementById('passwordMatch');
            
            if (confirmPasswordInput) {
                confirmPasswordInput.addEventListener('input', function() {
                    const password = passwordInput.value;
                    const confirmPassword = this.value;
                    
                    if (confirmPassword === '') {
                        passwordMatchSpan.textContent = '';
                        this.classList.remove('error', 'success');
                    } else if (password !== confirmPassword) {
                        passwordMatchSpan.textContent = '❌ Пароли не совпадают';
                        passwordMatchSpan.className = 'password-match error';
                        this.classList.add('error');
                        this.classList.remove('success');
                    } else {
                        passwordMatchSpan.textContent = '✅ Пароли совпадают';
                        passwordMatchSpan.className = 'password-match success';
                        this.classList.add('success');
                        this.classList.remove('error');
                    }
                });
            }
            
            // Обработка формы регистрации
            const registerForm = document.getElementById('registerForm');
            const messageDiv = document.getElementById('message');
            const submitBtn = document.getElementById('submitBtn');
            
            if (registerForm) {
                registerForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const username = document.getElementById('username').value.trim();
                    const email = document.getElementById('email').value.trim();
                    const password = document.getElementById('password').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    
                    // Валидация
                    if (!username || !email || !password || !confirmPassword) {
                        messageDiv.className = 'message error';
                        messageDiv.textContent = '❌ Заполните все поля';
                        return;
                    }
                    
                    if (password.length < 6) {
                        messageDiv.className = 'message error';
                        messageDiv.textContent = '❌ Пароль должен быть не менее 6 символов';
                        return;
                    }
                    
                    if (password !== confirmPassword) {
                        messageDiv.className = 'message error';
                        messageDiv.textContent = '❌ Пароли не совпадают';
                        return;
                    }
                    
                    // Блокируем кнопку
                    const originalBtnText = submitBtn.innerHTML;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Регистрируем...';
                    submitBtn.disabled = true;
                    
                    try {
                        const result = await window.authFunctions.register(email, password, username);
                        
                        if (result.success) {
                            messageDiv.className = 'message success';
                            messageDiv.innerHTML = '✅ Регистрация успешна! Добро пожаловать, ' + username + '!';
                            
                            // Обновляем прогресс регистрации
                            document.querySelectorAll('.progress-step').forEach(step => {
                                step.classList.remove('active');
                            });
                            document.querySelectorAll('.progress-step')[2].classList.add('active');
                            
                            setTimeout(() => {
                                window.location.href = 'forum.html';
                            }, 2000);
                        } else {
                            messageDiv.className = 'message error';
                            messageDiv.textContent = '❌ Ошибка: ' + result.error;
                        }
                    } catch (error) {
                        messageDiv.className = 'message error';
                        messageDiv.textContent = '❌ Неизвестная ошибка: ' + error.message;
                    } finally {
                        submitBtn.innerHTML = originalBtnText;
                        submitBtn.disabled = false;
                    }
                });
            }
        });
    </script>
</body>
</html>